6ce3d60d9659535df3a75b831b79d505aeddf66f1f3c96996082ed060ec73cf9:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"9c842d67-4f30-4c9d-a539-b31651aa6e28","step_position":[900,1080],"config_field_values":[],"task_id":"shopify::admin::order_created","task_version":"0.1","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"5d9c73c8-a68a-41cd-8274-c3811c28cdbe","step_position":[1520,1180],"config_field_values":[{"config_field_id":"company_id","value":"order.purchasingEntity.PurchasingCompany.company.id"},{"config_field_id":"namespace","value":"b2b"},{"config_field_id":"key","value":"credit_limit_remaining"},{"config_field_id":"value","value":"{%- assign paid_order_total = order.currentTotalPriceSet.presentmentMoney.amount -%}\n{%- assign starting_credit_limit_remaining = 0 | plus:0 -%}\n{%- assign ending_credit_limit = 0 | plus:0 -%}\n\n{%- for metafields_item in order.purchasingEntity.PurchasingCompany.company.metafields %}\n{%- if metafields_item.namespace == \"b2b\" and metafields_item.key == \"credit_limit_remaining\" -%}\n{%- assign starting_credit_limit_remaining = metafields_item.value -%}\n\n{%- endif -%}\n{%- endfor -%}\n\n{%- assign ending_credit_limit = starting_credit_limit_remaining | minus: paid_order_total -%}\n\n{%- if ending_credit_limit <=0 -%}\n{%- assign ending_credit_limit =  0 -%}\n{{- ending_credit_limit -}}\n{%- else -%}\n{{- ending_credit_limit -}}\n{%- endif -%}\n\n"},{"config_field_id":"value_type","value":"number_decimal"}],"task_id":"shopify::admin::add_company_metafield","task_version":"0.1","task_type":"ACTION","description":"Gets the current credit limit and then decreases that limit by the order amount. If order amount if greater than remaining limit, decrease to zero.","note":null,"name":null},{"step_id":"7e030370-b489-11ee-adeb-994b03935eab","step_position":[1220,1120],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"8a29ef43-d04c-11ee-9ec8-9db250d9c9b6\",\"lhs\":{\"uuid\":\"2e1c3b40-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"8a29ef43-d04c-11ee-9ec8-9db250d9c9b6\",\"array_path\":{\"uuid\":\"2e1c3b41-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b40-b48b-11ee-adeb-994b03935eab\",\"value\":\"order.customer.companyContactProfiles\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"\"},\"array_item_key\":{\"uuid\":\"2e1c3b42-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b40-b48b-11ee-adeb-994b03935eab\",\"value\":\"companyContactProfiles_item\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"\"},\"operation\":{\"uuid\":\"116fe9b2-d042-11ee-89ef-dd696cee916a\",\"parent_uuid\":\"2e1c3b40-b48b-11ee-adeb-994b03935eab\",\"lhs\":{\"uuid\":\"2e1c3b43-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"116fe9b2-d042-11ee-89ef-dd696cee916a\",\"array_path\":{\"uuid\":\"2e1c3b44-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b43-b48b-11ee-adeb-994b03935eab\",\"value\":\"companyContactProfiles_item.company.metafields\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"\"},\"array_item_key\":{\"uuid\":\"2e1c3b45-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b43-b48b-11ee-adeb-994b03935eab\",\"value\":\"metafields_item\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"\"},\"operation\":{\"uuid\":\"2e1c3b46-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b43-b48b-11ee-adeb-994b03935eab\",\"lhs\":{\"uuid\":\"2e1c3b47-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b46-b48b-11ee-adeb-994b03935eab\",\"lhs\":{\"uuid\":\"2e1c3b48-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b47-b48b-11ee-adeb-994b03935eab\",\"value\":\"metafields_item.namespace\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"metafields_item.namespace\"},\"rhs\":{\"uuid\":\"313f2620-b48b-11ee-adeb-994b03935eab\",\"parent_uuid\":\"2e1c3b47-b48b-11ee-adeb-994b03935eab\",\"value\":\"b2b\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"},\"operator\":\"ANY\",\"operation_type\":\"ArrayExpression\"},\"rhs\":{\"uuid\":\"116fc2a0-d042-11ee-89ef-dd696cee916a\",\"parent_uuid\":\"116fe9b2-d042-11ee-89ef-dd696cee916a\",\"lhs\":{\"uuid\":\"116fe9b0-d042-11ee-89ef-dd696cee916a\",\"parent_uuid\":\"116fc2a0-d042-11ee-89ef-dd696cee916a\",\"value\":\"order.unpaid\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"order.unpaid\"},\"rhs\":{\"uuid\":\"11c02c90-d042-11ee-89ef-dd696cee916a\",\"parent_uuid\":\"116fc2a0-d042-11ee-89ef-dd696cee916a\",\"value\":\"true\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:Boolean\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"},\"operator\":\"ANY\",\"operation_type\":\"ArrayExpression\"},\"rhs\":{\"uuid\":\"8a29ef40-d04c-11ee-9ec8-9db250d9c9b6\",\"parent_uuid\":\"8a29ef43-d04c-11ee-9ec8-9db250d9c9b6\",\"lhs\":{\"uuid\":\"8a29ef41-d04c-11ee-9ec8-9db250d9c9b6\",\"parent_uuid\":\"8a29ef40-d04c-11ee-9ec8-9db250d9c9b6\",\"value\":\"order.paymentTerms.paymentTermsType\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"order.paymentTerms.paymentTermsType\"},\"rhs\":{\"uuid\":\"8db7a9e0-d04c-11ee-9ec8-9db250d9c9b6\",\"parent_uuid\":\"8a29ef40-d04c-11ee-9ec8-9db250d9c9b6\",\"value\":\"NET\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentEnumDefinition:PaymentTermsType\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"OR\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Order is a B2B order AND Unpaid, OR on Net Terms.","note":null,"name":null}],"links":[{"from_step_id":"9c842d67-4f30-4c9d-a539-b31651aa6e28","from_port_id":"output","to_step_id":"7e030370-b489-11ee-adeb-994b03935eab","to_port_id":"input"},{"from_step_id":"7e030370-b489-11ee-adeb-994b03935eab","from_port_id":"true","to_step_id":"5d9c73c8-a68a-41cd-8274-c3811c28cdbe","to_port_id":"input"}],"patched_fields":[],"workflow_name":"Order Created | Decrease Remaining Credit Limit"}}