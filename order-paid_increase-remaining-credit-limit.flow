b0bc18c868716f010209f4e12105dca0503a60bab32a7c348a72349a64f3761e:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"80f1494c-5b5b-4880-a8ad-506b4f535674","step_position":[1000,1280],"config_field_values":[],"task_id":"shopify::admin::order_paid","task_version":"0.1","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"5c2700ec-618a-4a9f-9a40-633b7e56d99a","step_position":[1660,1440],"config_field_values":[{"config_field_id":"company_id","value":"order.purchasingEntity.PurchasingCompany.company.id"},{"config_field_id":"namespace","value":"b2b"},{"config_field_id":"key","value":"credit_limit_remaining"},{"config_field_id":"value","value":"{%- assign max_credit_limit = 0 | plus:0 -%}\n{%- assign starting_credit_limit_remaining = 0 | plus:0 -%}\n{%- assign paid_order_total = 0 | plus:0 -%}\n{%- assign potential_ending_credit  = 0 | plus:0 -%}\n{%- assign paid_order_total = order.currentTotalPriceSet.presentmentMoney.amount -%}\n\n{%- for metafields_item in order.purchasingEntity.PurchasingCompany.company.metafields -%}\n  {%- if metafields_item.namespace == \"b2b\" -%}\n{%- if metafields_item.key == \"credit_limit\" -%}\n  {%- assign max_credit_limit = metafields_item.value | plus: 0 -%}\n{%- elsif metafields_item.key == \"credit_limit_remaining\" -%}\n  {%- assign starting_credit_limit_remaining = metafields_item.value | plus: 0 -%}\n{%- endif -%}\n  {%- endif -%}\n{%- endfor -%}\n\n{%- assign potential_ending_credit = starting_credit_limit_remaining | plus: paid_order_total -%}\n\n{%- if potential_ending_credit > max_credit_limit -%}\n  {{- max_credit_limit -}}\n{%- else -%}\n  {{- potential_ending_credit -}}\n{%- endif -%}\n\n"},{"config_field_id":"value_type","value":"number_decimal"}],"task_id":"shopify::admin::add_company_metafield","task_version":"0.1","task_type":"ACTION","description":"Gets the starting / current credit limit remaining amount, and will update to a ending credit limit remaining amount based on paid order total.","note":null,"name":null},{"step_id":"fa425538-af55-44bd-991b-add6b6c15de0","step_position":[1320,1360],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"d776aee7-b4af-11ee-9b12-21673629dd0e\",\"lhs\":{\"uuid\":\"d776aee0-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee7-b4af-11ee-9b12-21673629dd0e\",\"array_path\":{\"uuid\":\"d776aee1-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee0-b4af-11ee-9b12-21673629dd0e\",\"value\":\"order.purchasingEntity.PurchasingCompany.company.metafields\",\"comparison_value_type\":\"EnvironmentValue\"},\"array_item_key\":{\"uuid\":\"d776aee2-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee0-b4af-11ee-9b12-21673629dd0e\",\"value\":\"metafields_item\",\"comparison_value_type\":\"EnvironmentValue\"},\"operation\":{\"uuid\":\"d776aee3-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee0-b4af-11ee-9b12-21673629dd0e\",\"lhs\":{\"uuid\":\"d776aee4-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee3-b4af-11ee-9b12-21673629dd0e\",\"lhs\":{\"uuid\":\"d776aee5-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee4-b4af-11ee-9b12-21673629dd0e\",\"value\":\"metafields_item.namespace\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"metafields_item.namespace\"},\"rhs\":{\"uuid\":\"daf06c50-b4af-11ee-9b12-21673629dd0e\",\"parent_uuid\":\"d776aee4-b4af-11ee-9b12-21673629dd0e\",\"value\":\"b2b\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"},\"operator\":\"ANY\",\"operation_type\":\"ArrayExpression\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Order is a B2B order","note":null,"name":null}],"links":[{"from_step_id":"80f1494c-5b5b-4880-a8ad-506b4f535674","from_port_id":"output","to_step_id":"fa425538-af55-44bd-991b-add6b6c15de0","to_port_id":"input"},{"from_step_id":"fa425538-af55-44bd-991b-add6b6c15de0","from_port_id":"true","to_step_id":"5c2700ec-618a-4a9f-9a40-633b7e56d99a","to_port_id":"input"}],"patched_fields":[],"workflow_name":"Order Paid | Increase Remaining Credit Limit"}}